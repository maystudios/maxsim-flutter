{
  "branchName": "main",
  "projectName": "maxsim-flutter",
  "userStories": [
    {
      "id": "P1-001",
      "phase": 1,
      "priority": 1,
      "title": "Implement TypeScript project foundation and CLI entry point",
      "description": "Set up the TypeScript project with Commander.js CLI framework. Create src/cli/index.ts as the bin entry point that registers the 'create', 'add', and 'migrate' commands (initially as stubs). Ensure 'npx maxsim-flutter --version' and 'npx maxsim-flutter --help' work correctly. Wire up the bin field in package.json to dist/cli/index.js with proper shebang.",
      "acceptanceCriteria": [
        "src/cli/index.ts exists with Commander.js program setup and shebang",
        "src/cli/commands/create.ts, add.ts, migrate.ts exist as stub commands",
        "'npm run build' compiles without errors",
        "'node dist/cli/index.js --version' prints '0.1.0'",
        "'node dist/cli/index.js --help' shows create, add, migrate commands"
      ],
      "passes": true
    },
    {
      "id": "P1-002",
      "phase": 1,
      "priority": 2,
      "title": "Implement Zod config schema and config loader",
      "description": "Create the central Zod schema in src/core/config/schema.ts that validates maxsim.config.yaml. Include all sections: project, platforms, modules (auth, api, database, i18n, theme, push, analytics, cicd, deep-linking), claude, scaffold. Create src/core/config/loader.ts to read and parse YAML config files. Create src/core/config/defaults.ts with sensible default values. Write unit tests for schema validation.",
      "acceptanceCriteria": [
        "src/core/config/schema.ts exports MaxsimConfigSchema with Zod",
        "src/core/config/loader.ts can read and validate a YAML file",
        "src/core/config/defaults.ts exports default config values",
        "src/types/config.ts exports MaxsimConfig type inferred from Zod",
        "tests/unit/schema.test.ts passes with valid and invalid config cases",
        "npm run typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "P1-003",
      "phase": 1,
      "priority": 3,
      "title": "Implement ProjectContext type and validator",
      "description": "Create src/core/context.ts with the ProjectContext interface that carries all resolved project settings through the pipeline. Create src/core/validator.ts that checks pre-flight requirements (Flutter SDK installed, Dart installed, git installed, target directory writable). Create src/types/project.ts with GeneratedFile and other shared types.",
      "acceptanceCriteria": [
        "src/core/context.ts exports ProjectContext interface",
        "src/core/validator.ts exports validateEnvironment() that checks flutter, dart, git",
        "src/types/project.ts exports GeneratedFile, TemplateInstruction types",
        "Validator returns clear error messages when tools are missing",
        "npm run typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "P1-004",
      "phase": 1,
      "priority": 4,
      "title": "Implement Handlebars template renderer",
      "description": "Create src/scaffold/renderer.ts with a Handlebars-based template renderer. Register custom helpers: ifEquals, ifIncludes, camelCase, pascalCase, snakeCase. The renderer takes a template file path and a TemplateContext, returns rendered string. Support partials for reusable template fragments. Write unit tests.",
      "acceptanceCriteria": [
        "src/scaffold/renderer.ts exports TemplateRenderer class",
        "Supports .hbs file rendering with TemplateContext",
        "Custom helpers (ifEquals, ifIncludes, camelCase, pascalCase, snakeCase) work",
        "Partial templates can be registered and used",
        "tests/unit/renderer.test.ts passes",
        "npm run typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "P1-005",
      "phase": 1,
      "priority": 5,
      "title": "Implement file writer with dry-run and conflict detection",
      "description": "Create src/scaffold/file-writer.ts that writes rendered files to the output directory. Support dry-run mode (prints what would be written without writing). Detect file conflicts when target files already exist. Support overwrite modes: ask, always, never. Write unit tests using a temp directory.",
      "acceptanceCriteria": [
        "src/scaffold/file-writer.ts exports FileWriter class",
        "writeAll() writes Map<path, content> to disk",
        "dry-run mode logs files without writing",
        "Conflict detection works when files exist",
        "Overwrite modes (ask/always/never) are respected",
        "tests/unit/file-writer.test.ts passes",
        "npm run typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "P1-006",
      "phase": 1,
      "priority": 6,
      "title": "Implement scaffold engine orchestrator",
      "description": "Create src/scaffold/engine.ts as the main orchestrator. It receives a ProjectContext and coordinates: module resolution -> template composition -> rendering -> file writing -> post-processing. Create post-processors in src/scaffold/post-processors/ for dart-format, flutter-pub-get, and build-runner (using execa to run shell commands).",
      "acceptanceCriteria": [
        "src/scaffold/engine.ts exports ScaffoldEngine class with run(context) method",
        "Engine chains: resolve modules -> compose templates -> render -> write -> post-process",
        "src/scaffold/post-processors/dart-format.ts runs 'dart format .'",
        "src/scaffold/post-processors/flutter-pub-get.ts runs 'flutter pub get'",
        "src/scaffold/post-processors/build-runner.ts runs 'dart run build_runner build'",
        "Post-processors can be skipped via config flags",
        "npm run typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "P1-007",
      "phase": 1,
      "priority": 7,
      "title": "Create core Flutter templates (Clean Architecture + Riverpod + go_router)",
      "description": "Create all Handlebars templates in templates/core/ for the base Flutter project. This includes: pubspec.yaml.hbs, analysis_options.yaml.hbs, lib/main.dart.hbs (ProviderScope + GoRouter setup), lib/app.dart.hbs, lib/core/router/app_router.dart.hbs, lib/core/theme/app_theme.dart.hbs, lib/core/providers/app_providers.dart.hbs, lib/features/home/ example feature with data/domain/presentation layers, test/widget_test.dart.hbs.",
      "acceptanceCriteria": [
        "templates/core/pubspec.yaml.hbs generates valid pubspec with riverpod, go_router, build_runner",
        "templates/core/analysis_options.yaml.hbs includes recommended Flutter lints",
        "templates/core/lib/main.dart.hbs has ProviderScope and MaterialApp.router",
        "templates/core/lib/core/router/app_router.dart.hbs has TypedGoRoute setup",
        "templates/core/lib/features/home/ has Clean Architecture layers",
        "templates/core/test/widget_test.dart.hbs is a valid test",
        "All templates use TemplateContext variables correctly"
      ],
      "passes": true
    },
    {
      "id": "P1-008",
      "phase": 1,
      "priority": 8,
      "title": "Implement interactive create command with @clack/prompts",
      "description": "Wire up src/cli/commands/create.ts to be fully functional. Use @clack/prompts for interactive input: project name, org ID, description, platform selection (checkboxes). Build a ProjectContext from user input + defaults. Call ScaffoldEngine.run(). Show spinner during generation, success message after. Support --yes flag for non-interactive mode.",
      "acceptanceCriteria": [
        "src/cli/commands/create.ts prompts for name, org, description, platforms",
        "src/cli/ui/prompts.ts wraps @clack/prompts for project creation questions",
        "Builds ProjectContext from interactive answers",
        "Calls ScaffoldEngine.run(context) to generate the project",
        "Shows ora spinner during generation",
        "--yes flag skips all prompts and uses defaults",
        "Writes maxsim.config.yaml to generated project"
      ],
      "passes": true
    },
    {
      "id": "P1-009",
      "phase": 1,
      "priority": 9,
      "title": "Integration test: create command generates working Flutter project",
      "description": "Write an integration test that runs the create command into a temp directory and validates the output. Check that the Flutter project structure is correct, pubspec.yaml is valid YAML, Clean Architecture directories exist, and key files contain expected content.",
      "acceptanceCriteria": [
        "tests/integration/create-command.test.ts exists and passes",
        "Test creates a project in a temp directory",
        "Validates directory structure matches Clean Architecture",
        "Validates pubspec.yaml is valid and contains required deps",
        "Validates main.dart contains ProviderScope",
        "Validates app_router.dart contains GoRouter setup",
        "npm test passes all tests"
      ],
      "passes": true
    },
    {
      "id": "P2-001",
      "phase": 2,
      "priority": 10,
      "title": "Implement ModuleManifest interface and module registry",
      "description": "Create src/types/module.ts with ModuleManifest, ModuleContribution, ModuleQuestion interfaces. Create src/modules/registry.ts that discovers and loads all module definitions from src/modules/definitions/. Create src/modules/definitions/core/module.ts as the always-included base module.",
      "acceptanceCriteria": [
        "src/types/module.ts exports ModuleManifest with all fields",
        "src/modules/registry.ts exports ModuleRegistry that loads all module definitions",
        "src/modules/definitions/core/module.ts exports a valid ModuleManifest",
        "Registry correctly discovers all module definitions",
        "npm run typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "P2-002",
      "phase": 2,
      "priority": 11,
      "title": "Implement module dependency resolver with topological sort",
      "description": "Create src/modules/resolver.ts that performs topological sort on selected modules based on their 'requires' dependencies. Detect and reject circular dependencies. Validate that no conflicting modules are selected together. Write unit tests.",
      "acceptanceCriteria": [
        "src/modules/resolver.ts exports ModuleResolver with resolve(selectedIds) method",
        "Topological sort orders modules by dependency",
        "Circular dependency detection throws clear error",
        "Conflict detection prevents incompatible modules",
        "tests/unit/resolver.test.ts covers: valid order, missing dep, circular, conflict",
        "npm run typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "P2-003",
      "phase": 2,
      "priority": 12,
      "title": "Implement module composer with pubspec merging",
      "description": "Create src/modules/composer.ts that takes resolved ModuleManifests and a ProjectContext, then merges all template contributions into a unified file map. Pubspec.partial.yaml merging and provider contributions to app_providers.dart. Write unit tests.",
      "acceptanceCriteria": [
        "src/modules/composer.ts exports ModuleComposer with compose() method",
        "Merges pubspec.partial.yaml fragments from all active modules",
        "Deduplicates dependencies (newer version wins)",
        "Merges provider contributions into app_providers.dart barrel file",
        "tests/unit/composer.test.ts passes",
        "npm run typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "P2-004",
      "phase": 2,
      "priority": 13,
      "title": "Implement auth module definition and templates",
      "description": "Create src/modules/definitions/auth/module.ts with full ModuleManifest for authentication. Support providers: firebase, supabase, custom. Create templates/modules/auth/ with Clean Architecture layers. Include pubspec.partial.yaml.",
      "acceptanceCriteria": [
        "src/modules/definitions/auth/module.ts exports valid ModuleManifest",
        "templates/modules/auth/lib/features/auth/ has domain, data, presentation layers",
        "templates/modules/auth/pubspec.partial.yaml has correct deps per provider",
        "Templates use conditional rendering for provider-specific code"
      ],
      "passes": true
    },
    {
      "id": "P2-005",
      "phase": 2,
      "priority": 14,
      "title": "Implement API module definition and templates",
      "description": "Create src/modules/definitions/api/module.ts for HTTP client setup with Dio, interceptors, error handling. Create templates/modules/api/ with Dio client setup.",
      "acceptanceCriteria": [
        "src/modules/definitions/api/module.ts exports valid ModuleManifest",
        "templates/modules/api/ has Dio client setup with interceptors",
        "Error handling with typed ApiException",
        "pubspec.partial.yaml includes dio, retrofit, json_annotation"
      ],
      "passes": true
    },
    {
      "id": "P2-006",
      "phase": 2,
      "priority": 15,
      "title": "Implement theme module definition and templates",
      "description": "Create src/modules/definitions/theme/module.ts for advanced theming with Material 3 seed color, dark/light switching via Riverpod.",
      "acceptanceCriteria": [
        "src/modules/definitions/theme/module.ts exports valid ModuleManifest",
        "templates/modules/theme/ has ThemeData setup with ColorScheme.fromSeed",
        "Theme provider supports light/dark mode switching via Riverpod",
        "pubspec.partial.yaml has theme-related deps"
      ],
      "passes": true
    },
    {
      "id": "P2-007",
      "phase": 2,
      "priority": 16,
      "title": "Wire module selection into create command and integration test",
      "description": "Update create command with interactive module selection, per-module config questions, --modules flag. Wire ModuleResolver and ModuleComposer into ScaffoldEngine. Update integration test.",
      "acceptanceCriteria": [
        "Create command shows module selection checkboxes",
        "--modules auth,api,theme flag works for non-interactive mode",
        "ScaffoldEngine uses ModuleResolver and ModuleComposer",
        "Generated project includes selected module files",
        "pubspec.yaml contains merged dependencies",
        "npm test passes all tests"
      ],
      "passes": true
    },
    {
      "id": "P2-008",
      "phase": 2,
      "priority": 17,
      "title": "Implement database module definition and templates",
      "description": "Create database module supporting drift, hive, and isar with templates for each engine.",
      "acceptanceCriteria": [
        "src/modules/definitions/database/module.ts exports valid ModuleManifest",
        "Templates conditionally render based on engine choice",
        "pubspec.partial.yaml includes correct deps per engine"
      ],
      "passes": true
    },
    {
      "id": "P2-009",
      "phase": 2,
      "priority": 18,
      "title": "Implement i18n module definition and templates",
      "description": "Create i18n module with ARB files, l10n.yaml config, localization delegates in MaterialApp.",
      "acceptanceCriteria": [
        "src/modules/definitions/i18n/module.ts exports valid ModuleManifest",
        "Templates include ARB files for selected locales",
        "MaterialApp.router uses localizationsDelegates",
        "pubspec.partial.yaml includes flutter_localizations, intl"
      ],
      "passes": true
    },
    {
      "id": "P2-010",
      "phase": 2,
      "priority": 19,
      "title": "Implement push, analytics, cicd, deep-linking modules",
      "description": "Create remaining four module definitions and their templates: push notifications (firebase/onesignal), analytics (service abstraction + go_router observer), CI/CD (github/gitlab/bitbucket pipelines), deep linking (app links + go_router integration).",
      "acceptanceCriteria": [
        "src/modules/definitions/push/module.ts with firebase/onesignal support",
        "src/modules/definitions/analytics/module.ts with AnalyticsService abstraction",
        "src/modules/definitions/cicd/module.ts with GitHub Actions/GitLab CI templates",
        "src/modules/definitions/deep-linking/module.ts with go_router integration",
        "All four modules have valid templates and pubspec partials"
      ],
      "passes": true
    },
    {
      "id": "P3-001",
      "phase": 3,
      "priority": 20,
      "title": "Implement CLAUDE.md generator for Flutter projects",
      "description": "Create src/claude-setup/claude-md-generator.ts that generates a comprehensive CLAUDE.md optimized for Claude Code Agent Teams. Include: architecture rules, Riverpod patterns, go_router conventions, Agent Teams workflow instructions (how to create a team, what roles to spawn, how to use prd.json as task source), module-specific sections, quality gates.",
      "acceptanceCriteria": [
        "src/claude-setup/claude-md-generator.ts exports generateClaudeMd(context)",
        "Generated CLAUDE.md includes Agent Teams workflow section",
        "Architecture section covers Clean Arch layer rules",
        "Riverpod and go_router sections with patterns",
        "Module-specific sections conditionally included",
        "Quality gates section (flutter analyze, flutter test)"
      ],
      "passes": true
    },
    {
      "id": "P3-002",
      "phase": 3,
      "priority": 21,
      "title": "Implement agent definitions writer for Flutter projects",
      "description": "Create src/claude-setup/agent-writer.ts that generates .claude/agents/ optimized for Agent Teams. Agents are designed as teammate roles: architect reviews architecture before builders implement, tester validates after builders finish, reviewer checks Clean Arch compliance, docs writes documentation. Each agent has clear scope and communication patterns.",
      "acceptanceCriteria": [
        "src/claude-setup/agent-writer.ts exports writeAgents(context, outputPath)",
        "5 agent templates designed as Agent Teams teammates",
        "flutter-architect: Sonnet, read-only tools, reviews before implementation",
        "flutter-feature-builder: Sonnet, all tools, claims tasks and implements",
        "flutter-tester: Sonnet, all tools, messages builders about failures",
        "flutter-reviewer: Sonnet, read-only tools, reviews after implementation",
        "flutter-docs: Haiku, edit tools, documents after review"
      ],
      "passes": true
    },
    {
      "id": "P3-003",
      "phase": 3,
      "priority": 22,
      "title": "Implement skills, hooks, and MCP config writer",
      "description": "Create skill writer (flutter-patterns, go-router-patterns, module-conventions, prd skills). Create hooks writer with TaskCompleted hook that enforces flutter analyze + flutter test. Create MCP config writer. Create commands (add-feature, analyze).",
      "acceptanceCriteria": [
        "4 skill templates generated in .claude/skills/",
        "TaskCompleted hook runs flutter analyze + flutter test",
        "TeammateIdle hook optionally checks for uncommitted work",
        ".mcp.json includes relevant MCP servers based on modules",
        "Commands: add-feature.md, analyze.md"
      ],
      "passes": true
    },
    {
      "id": "P3-004",
      "phase": 3,
      "priority": 23,
      "title": "Wire Claude setup into scaffold engine and generate PRD",
      "description": "Update ScaffoldEngine to call all claude-setup generators. Generate .claude/ directory with CLAUDE.md, agents, skills, commands, hooks, MCP config. Implement PRD generator that creates prd.json for the generated Flutter project (so Agent Teams can use it as task source). Respect --no-claude flag.",
      "acceptanceCriteria": [
        "ScaffoldEngine generates complete .claude/ directory",
        "--no-claude flag skips Claude setup",
        "PRD generator creates prd.json with phased stories from selected modules",
        "All agents, skills, commands, hooks present in generated project",
        "Integration test verifies .claude/ output"
      ],
      "passes": true
    },
    {
      "id": "P3-005",
      "phase": 3,
      "priority": 24,
      "title": "Implement add command for adding modules to existing projects",
      "description": "Implement src/cli/commands/add.ts fully. Detect existing project, validate module, generate files, merge pubspec, update config, update Claude setup.",
      "acceptanceCriteria": [
        "src/cli/commands/add.ts fully functional",
        "Detects maxsim.config.yaml in project",
        "Generates only new module files",
        "Merges new dependencies into existing pubspec.yaml",
        "Updates maxsim.config.yaml and .claude/ setup",
        "--dry-run shows what would change"
      ],
      "passes": true
    },
    {
      "id": "P3-006",
      "phase": 3,
      "priority": 25,
      "title": "Implement migrate command with analysis",
      "description": "Implement migrate command with project detector. Analyze existing Flutter project structure, detect patterns, report gaps, create maxsim.config.yaml, add .claude/ setup.",
      "acceptanceCriteria": [
        "src/cli/commands/migrate.ts fully functional",
        "src/core/detector.ts analyzes existing Flutter project",
        "--analysis-only outputs report without changes",
        "Full migrate creates maxsim.config.yaml and .claude/ directory",
        "Non-destructive: never deletes existing files"
      ],
      "passes": true
    },
    {
      "id": "P4-001",
      "phase": 4,
      "priority": 26,
      "title": "Create Claude Code plugin structure",
      "description": "Create claude-plugin/ with plugin.json, commands (flutter-create, flutter-add, flutter-migrate), skills (flutter-scaffolding), and agents (flutter-setup-agent).",
      "acceptanceCriteria": [
        "claude-plugin/.claude-plugin/plugin.json has valid metadata",
        "3 command files wrapping CLI commands",
        "flutter-scaffolding skill provides module context",
        "flutter-setup-agent guides users through setup"
      ],
      "passes": true
    },
    {
      "id": "P4-002",
      "phase": 4,
      "priority": 27,
      "title": "Write README and documentation",
      "description": "Write README.md covering: installation, quick start, all commands, module descriptions, Agent Teams workflow (how to use generated projects with Claude Code Agent Teams), Ralph fallback, config reference, contributing guide.",
      "acceptanceCriteria": [
        "README.md has installation and quick start",
        "All 3 commands documented with flags and examples",
        "Agent Teams workflow section with step-by-step guide",
        "Module table with descriptions",
        "Configuration reference"
      ],
      "passes": true
    },
    {
      "id": "P4-003",
      "phase": 4,
      "priority": 28,
      "title": "Full integration test suite and npm publish preparation",
      "description": "Comprehensive integration tests, CHANGELOG.md, verify npm pack, ensure all quality gates pass.",
      "acceptanceCriteria": [
        "Integration tests for create, add, migrate commands",
        "Test: create with all modules generates complete project with .claude/",
        "Test: add module merges correctly",
        "CHANGELOG.md with v0.1.0 entry",
        "'npm pack' produces correct tarball",
        "All tests pass, typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "P5-001",
      "phase": 5,
      "priority": 29,
      "title": "GitHub Actions CI/CD for maxsim-flutter",
      "description": "Create .github/workflows/ci.yml that runs npm run typecheck, npm run lint, and npm test on every push and PR. Add a release.yml workflow triggered by v* tags that publishes to npm with provenance (--provenance flag).",
      "acceptanceCriteria": [
        ".github/workflows/ci.yml runs typecheck + lint + test on push/PR to main",
        ".github/workflows/release.yml triggers on v* tags, builds, tests, then npm publish --provenance",
        "Secrets documented: NPM_TOKEN required in repo settings",
        "Badge in README links to workflow status"
      ],
      "passes": true
    },
    {
      "id": "P5-002",
      "phase": 5,
      "priority": 30,
      "title": "Prepare package for first npm publish",
      "description": "Fix repository.url in package.json to real GitHub URL. Verify files[] array is complete. Add publishConfig with access: public. Run npm pack --dry-run and verify tarball contents. Confirm prepublishOnly runs build + test. Create LICENSE file if missing.",
      "acceptanceCriteria": [
        "npm pack --dry-run shows exactly: dist/, templates/, claude-plugin/, README.md, CHANGELOG.md, package.json, LICENSE",
        "package.json has real repository.url and publishConfig: { access: public }",
        "npm run prepublishOnly passes typecheck, lint, and tests",
        "No .env, secrets, or dev files included in pack"
      ],
      "passes": true
    },
    {
      "id": "P5-003",
      "phase": 5,
      "priority": 31,
      "title": "Implement list command to show project module status",
      "description": "Create src/cli/commands/list.ts. Detect maxsim.config.yaml, display table of all modules and their enabled/disabled status. Support --project-dir flag.",
      "acceptanceCriteria": [
        "maxsim-flutter list outputs a readable table of all modules with their status",
        "maxsim-flutter list --project-dir <path> works",
        "Throws helpful error if no maxsim.config.yaml found",
        "Unit tests added",
        "Command registered in CLI entry point"
      ],
      "passes": true
    },
    {
      "id": "P5-004",
      "phase": 5,
      "priority": 32,
      "title": "Extract shared template helpers to eliminate create/add duplication",
      "description": "Both create.ts and add.ts contain copies of buildTemplateContext and pubspec-merging logic. Extract to src/scaffold/template-helpers.ts and update both commands to import from shared location.",
      "acceptanceCriteria": [
        "src/scaffold/template-helpers.ts exports shared functions",
        "create.ts and add.ts both import from the shared module",
        "No duplicate function bodies remain",
        "All existing tests still pass",
        "npm run typecheck and npm run lint pass"
      ],
      "passes": true
    },
    {
      "id": "P5-005",
      "phase": 5,
      "priority": 33,
      "title": "Improve post-processor error handling and user feedback",
      "description": "engine.ts silently swallows all post-processor errors. Capture error messages and surface them to users. Add postProcessorErrors array to ScaffoldResult.",
      "acceptanceCriteria": [
        "ScaffoldResult includes postProcessorErrors: string[]",
        "When dart format fails, user sees: dart format skipped with reason",
        "When flutter pub get fails, user sees the actual error message",
        "Engine tests updated to verify error messages surface"
      ],
      "passes": true
    },
    {
      "id": "P5-006",
      "phase": 5,
      "priority": 34,
      "title": "Add version check and update nudge on CLI startup",
      "description": "On first run per day, check npm registry for latest version. If newer version exists, print a friendly nudge. Non-blocking (network failure silently ignored). Throttled by timestamp file.",
      "acceptanceCriteria": [
        "Version check runs at most once per day",
        "Network errors silently ignored",
        "Nudge appears at bottom of command output",
        "--no-update-check flag disables the check globally"
      ],
      "passes": true
    },
    {
      "id": "P5-NPM-001",
      "phase": 5,
      "priority": 35,
      "title": "Automated npm publish workflow with provenance attestation",
      "description": "Create .github/workflows/release.yml triggered by v* tags. Steps: checkout, Node 18, npm ci, npm run prepublishOnly, npm publish --provenance --access public. Configure NPM_TOKEN secret. Add npm badge to README.",
      "acceptanceCriteria": [
        "Tag v0.1.0 triggers release workflow",
        "Workflow passes typecheck + lint + test before publish",
        "Package published with provenance",
        "npm badge in README shows current version",
        "Documented: how to create a release (tag + push)"
      ],
      "passes": true
    },
    {
      "id": "P5-NPM-002",
      "phase": 5,
      "priority": 36,
      "title": "Package validation and dry-run gate",
      "description": "Add validate:pack npm script that runs npm pack --dry-run and asserts correct files included, no secrets, size < 2MB. Integrate into CI.",
      "acceptanceCriteria": [
        "npm run validate:pack script exists",
        "Script fails if node_modules/ or .env appear in pack output",
        "CI runs validate:pack step before npm publish",
        "Total pack size < 2MB enforced"
      ],
      "passes": true
    },
    {
      "id": "P5-NPM-003",
      "phase": 5,
      "priority": 37,
      "title": "CHANGELOG and release notes automation",
      "description": "Install conventional-changelog-cli. Add changelog npm script. Document commit convention. Verify existing CHANGELOG.md with v0.1.0 entry.",
      "acceptanceCriteria": [
        "CHANGELOG.md exists with v0.1.0 entry",
        "npm run changelog updates CHANGELOG.md from commit history",
        "Commit format generates correct changelog entries",
        "CHANGELOG linked from README"
      ],
      "passes": true
    },
    {
      "id": "P6-001",
      "phase": 6,
      "priority": 38,
      "title": "Expand template coverage for push, analytics, and deep-linking modules",
      "description": "Audit templates against auth/api benchmark. Push missing use cases, analytics missing route observer wiring, deep-linking missing route handler integration.",
      "acceptanceCriteria": [
        "Push module has domain/usecases/ with RequestPermissionUseCase, HandleNotificationUseCase",
        "Analytics module analytics_route_observer.dart is wired into app_router",
        "Deep-linking module provider is wired into GoRouter redirect guard",
        "Integration tests verify new files are generated"
      ],
      "passes": true
    },
    {
      "id": "P6-002",
      "phase": 6,
      "priority": 39,
      "title": "Generate README.md in scaffolded projects",
      "description": "Add templates/core/README.md.hbs that documents project structure, enabled modules, run instructions, Agent Teams section.",
      "acceptanceCriteria": [
        "README.md is generated in every new project",
        "README contains project name, enabled modules list, run instructions",
        "README has Agent Teams section if claude.agentTeams is true",
        "Integration test verifies README generated with correct project name"
      ],
      "passes": true
    },
    {
      "id": "P6-003",
      "phase": 6,
      "priority": 40,
      "title": "Make module ID lists registry-driven",
      "description": "engine.ts getEnabledModuleIds and add.ts ADDABLE_MODULE_IDS are hardcoded. Refactor so ModuleRegistry is single source of truth.",
      "acceptanceCriteria": [
        "ModuleRegistry.getAllOptionalIds() returns all registered non-core module IDs",
        "engine.ts getEnabledModuleIds uses the registry",
        "add.ts ADDABLE_MODULE_IDS replaced by registry query",
        "Adding a new module requires ONLY module.ts + templates",
        "All existing tests still pass"
      ],
      "passes": true
    },
    {
      "id": "P6-004",
      "phase": 6,
      "priority": 41,
      "title": "Add snapshot tests for generated Dart file content",
      "description": "Add Jest snapshot tests for key rendered files (main.dart, app_router.dart, login_page.dart) across module combinations.",
      "acceptanceCriteria": [
        "tests/unit/snapshots/ directory with .snap files",
        "toMatchSnapshot() used for main.dart, pubspec.yaml, app_router.dart",
        "Snapshot update workflow documented",
        "CI fails if snapshots drift without being updated"
      ],
      "passes": true
    },
    {
      "id": "P6-005",
      "phase": 6,
      "priority": 42,
      "title": "Improve migrate detector with lib/ directory structure analysis",
      "description": "Enhance ProjectDetector to scan lib/ for feature structure, identify layer violations, produce more precise gap analysis.",
      "acceptanceCriteria": [
        "analyzeProject() scans lib/ for features/ subdirectories",
        "Detects existing feature names and reports them",
        "Identifies direct presentation-to-data imports as a gap",
        "AnalysisReport.detectedFeatures field contains discovered feature names",
        "Updated unit tests for enhanced detector"
      ],
      "passes": true
    },
    {
      "id": "P6-006",
      "phase": 6,
      "priority": 43,
      "title": "Add per-module configuration prompts in interactive create flow",
      "description": "After module multi-select in create, show follow-up prompts for auth provider, database engine, API base URL, locales etc. --yes skips with defaults.",
      "acceptanceCriteria": [
        "After module selection, follow-up prompts appear for modules with questions",
        "--yes flag skips follow-up prompts and uses defaults",
        "Unit test for prompt flow using mock answers",
        "No regression on existing --yes non-interactive path"
      ],
      "passes": true
    },
    {
      "id": "P7-001",
      "phase": 7,
      "priority": 44,
      "title": "Support external/community module packages",
      "description": "Allow users to register third-party module packages via maxsim.config.yaml externalModules array. CLI resolves and loads from node_modules at runtime.",
      "acceptanceCriteria": [
        "maxsim.config.yaml supports externalModules: string[]",
        "ModuleRegistry.loadExternal(packageName) loads from node_modules",
        "Sample module package structure documented",
        "Error thrown if external module has invalid manifest",
        "Unit tests for external module loading"
      ],
      "passes": true
    },
    {
      "id": "P7-002",
      "phase": 7,
      "priority": 45,
      "title": "Implement upgrade command to refresh .claude/ directory",
      "description": "maxsim-flutter upgrade re-runs runClaudeSetup with current config and latest templates. Backs up user-edited agent files before overwrite.",
      "acceptanceCriteria": [
        "maxsim-flutter upgrade re-generates CLAUDE.md and .claude/ contents",
        "Existing user-edited agent files backed up with .bak extension",
        "--dry-run shows what would change",
        "Success message lists updated files"
      ],
      "passes": true
    },
    {
      "id": "P7-003",
      "phase": 7,
      "priority": 46,
      "title": "Add CI step that validates generated Dart code compiles",
      "description": "Add flutter-validate.yml workflow using Flutter Docker image. Creates test project, runs flutter pub get, flutter analyze.",
      "acceptanceCriteria": [
        ".github/workflows/flutter-validate.yml exists",
        "Uses subosito/flutter-action@v2 to install Flutter",
        "Tests core + auth + api + theme combinations",
        "Fails CI if flutter analyze reports errors",
        "Annotated as separate workflow not blocking main CI"
      ],
      "passes": true
    },
    {
      "id": "P7-004",
      "phase": 7,
      "priority": 47,
      "title": "Write contributor guide and architecture documentation",
      "description": "Create CONTRIBUTING.md with dev setup, how to add a module, template conventions, test instructions, PR process. Create docs/architecture.md.",
      "acceptanceCriteria": [
        "CONTRIBUTING.md at project root with complete dev setup instructions",
        "How to add a new module walkthrough",
        "docs/architecture.md describes subsystem relationships with diagram",
        "README has Contributing section linking to CONTRIBUTING.md"
      ],
      "passes": true
    },
    {
      "id": "P7-005",
      "phase": 7,
      "priority": 48,
      "title": "Interactive create wizard â€” project template presets",
      "description": "Before asking individual questions, offer preset bundles: Minimal (core), Standard (auth+api+theme), Full Featured (all), Custom (pick manually).",
      "acceptanceCriteria": [
        "First prompt in interactive flow is preset selection",
        "Selecting Standard pre-fills auth/api/theme",
        "Selecting Full Featured pre-fills all 9 modules",
        "Custom falls through to existing module multi-select",
        "--yes skips preset and defaults to minimal"
      ],
      "passes": true
    },
    {
      "id": "P8-001",
      "phase": 8,
      "priority": 49,
      "title": "Add claude.preset to config schema",
      "description": "Replace the granular claude.generateAgents, claude.generateSkills, claude.generateHooks, claude.agentTeams boolean flags with a single claude.preset field supporting 'minimal', 'standard', 'full'. Add claude.overrides object for per-component override. Maintain backward compatibility with old boolean flags.",
      "acceptanceCriteria": [
        "MaxsimConfigSchema accepts claude.preset: 'minimal' | 'standard' | 'full'",
        "Old boolean flags (generateAgents, etc.) still work for backward compatibility",
        "claude.overrides can override individual preset components",
        "Zod validation rejects invalid preset values",
        "npm run typecheck passes",
        ">= 4 tests (schema validation happy path, each preset, override, backward compat)"
      ],
      "passes": true
    },
    {
      "id": "P8-002",
      "phase": 8,
      "priority": 50,
      "title": "Implement preset resolver",
      "description": "Create src/claude-setup/preset-resolver.ts that resolves claude.preset + claude.overrides into concrete boolean flags (ResolvedClaudeOptions) for each component: claudeMd, rules, agents, hooks, skills, commands, mcp. Wire into setup-orchestrator.",
      "acceptanceCriteria": [
        "resolvePreset('minimal') returns only claudeMd + rules enabled",
        "resolvePreset('standard') returns all except MCP",
        "resolvePreset('full') returns all enabled",
        "Overrides correctly override preset defaults",
        ">= 6 tests (3 presets + 3 override scenarios)"
      ],
      "passes": true
    },
    {
      "id": "P8-003",
      "phase": 8,
      "priority": 51,
      "title": "Update interactive create wizard for preset selection",
      "description": "Add preset selection to the interactive create command prompts. Interactive mode shows preset selection: minimal / standard (default) / full. Non-interactive --yes defaults to standard. --config file with claude.preset is respected.",
      "acceptanceCriteria": [
        "Interactive mode shows preset selection: minimal / standard (default) / full",
        "Non-interactive --yes defaults to standard",
        "--config file with claude.preset is respected",
        ">= 2 tests"
      ],
      "passes": true
    },
    {
      "id": "P8-004",
      "phase": 8,
      "priority": 52,
      "title": "Overhaul CLAUDE.md generator (slim ~80 lines)",
      "description": "Completely rewrite claude-md-generator.ts to produce a slim CLAUDE.md (~80 lines) that acts as an index file with @ imports to .claude/rules/ files. Include: project header with active modules/platforms, build commands, quality gates, @-imports to rule files, development workflow, key paths.",
      "acceptanceCriteria": [
        "Generated CLAUDE.md is <= 100 lines",
        "Contains @ imports to all generated rule files",
        "Module-conditional content (only shows enabled modules)",
        "Build commands, quality gates, and key paths included",
        "npm run typecheck passes",
        ">= 4 tests (full module set, minimal, no-claude, content assertions)"
      ],
      "passes": true
    },
    {
      "id": "P8-005",
      "phase": 8,
      "priority": 53,
      "title": "Create rules-writer module",
      "description": "Create src/claude-setup/rules-writer.ts that generates .claude/rules/ files with path-specific YAML frontmatter. Generate: architecture.md (Clean Architecture layers), riverpod.md (provider patterns), go-router.md (routing), testing.md (test conventions), security.md (always generated), plus conditional module-specific rules for auth, api, database, i18n.",
      "acceptanceCriteria": [
        "writeRules(context, outputPath) generates .claude/rules/ directory",
        "Each rule file has YAML frontmatter with paths array",
        "architecture.md always generated with layer rules",
        "security.md always generated",
        "Module-specific rules only generated when module is enabled",
        "Rules content is concise and actionable (not prose)",
        "npm run typecheck passes",
        ">= 8 tests (each rule file, conditional generation, path filtering)"
      ],
      "passes": true
    },
    {
      "id": "P8-006",
      "phase": 8,
      "priority": 54,
      "title": "Add security rules to generated projects",
      "description": "Ensure security.md is always generated in .claude/rules/ regardless of preset. Content covers: secrets & credentials (no hardcoded keys, use flutter_secure_storage), input validation (sanitize, strong typing), dependencies (pub.dev trust), API security (HTTPS, cert pinning, secure token storage), file & data handling (no PII logging, encryption at rest).",
      "acceptanceCriteria": [
        "security.md is always generated regardless of preset",
        "Content covers secrets, input validation, dependencies, API security, data handling",
        "No path restriction (applies to all code)",
        ">= 2 tests"
      ],
      "passes": true
    },
    {
      "id": "P8-007",
      "phase": 8,
      "priority": 55,
      "title": "Overhaul agent-writer with 3 focused agents + intelligent model routing",
      "description": "Rewrite agent-writer.ts to generate 3 focused agents instead of 5: flutter-builder (sonnet, all tools, implementation + architecture), flutter-tester (sonnet, all tools, TDD-first), flutter-reviewer (haiku, read-only tools, compliance checking). Each agent includes model selection rationale, sub-agent usage guidance, module context, and references to .claude/rules/.",
      "acceptanceCriteria": [
        "writeAgents() generates exactly 3 agent files (not 5)",
        "flutter-builder uses model: sonnet with all implementation tools",
        "flutter-tester uses model: sonnet with all tools including Bash",
        "flutter-reviewer uses model: haiku with read-only tools (Read, Grep, Glob)",
        "Each agent body includes model selection rationale",
        "Builder and tester include sub-agent usage guidance",
        "Reviewer explicitly states no sub-agents needed",
        "Each agent body includes module context from enabled modules",
        "Agent prompts reference .claude/rules/ files",
        "npm run typecheck passes",
        ">= 8 tests (agent count, each agent's tools/model/content, sub-agent guidance)"
      ],
      "passes": true
    },
    {
      "id": "P8-008",
      "phase": 8,
      "priority": 56,
      "title": "Create hook script generators",
      "description": "Generate executable hook scripts and comprehensive hooks configuration. Create .claude/hooks/block-dangerous.sh (PreToolUse on Bash, blocks rm -rf, --no-verify, --force, git reset --hard, git clean -f), .claude/hooks/format-dart.sh (PostToolUse on Edit|Write, auto-formats .dart files), and .claude/settings.local.json registering all hooks including TaskCompleted (flutter analyze + flutter test).",
      "acceptanceCriteria": [
        "writeHooks() generates .claude/hooks/ directory with 2 shell scripts",
        "Shell scripts have executable permissions (mode 0o755)",
        "block-dangerous.sh reads JSON from stdin, blocks dangerous patterns, exits 2 on block",
        "format-dart.sh reads JSON from stdin, formats .dart files only",
        "settings.local.json registers PreToolUse, PostToolUse, and TaskCompleted hooks",
        "Hooks only generated when preset includes hooks (standard/full)",
        "npm run typecheck passes",
        ">= 6 tests (script content, settings structure, preset gating, file permissions)"
      ],
      "passes": true
    },
    {
      "id": "P8-009",
      "phase": 8,
      "priority": 57,
      "title": "Improve existing skill content",
      "description": "Enhance the 4 existing skills with better examples and more practical patterns. flutter-patterns: add freezed data class patterns, error handling with AsyncValue. go-router-patterns: add ShellRoute example, nested navigation, redirect patterns. module-conventions: add concrete step-by-step 'how to add a feature'. prd: update to reflect new PRD format with acceptance criteria + dependencies.",
      "acceptanceCriteria": [
        "Each skill content is improved with more practical examples",
        "prd.md skill reflects new PRD schema (acceptance criteria, dependencies, etc.)",
        "flutter-patterns includes freezed and AsyncValue error handling",
        "npm run typecheck passes",
        ">= 4 tests (content assertions for each skill)"
      ],
      "passes": true
    },
    {
      "id": "P8-010",
      "phase": 8,
      "priority": 58,
      "title": "Create security-review and performance-check skills with model hints",
      "description": "Add two new skills to the generator. security-review.md (model: sonnet) covers secrets, input validation, API security, data protection. performance-check.md (model: haiku) covers widget rebuilds, provider efficiency, images/assets, lists/scrolling. Also add add-feature skill (model: sonnet). Skills only generated when preset includes skills (standard/full).",
      "acceptanceCriteria": [
        "writeSkills() generates 6 skill files (4 existing + 2 new)",
        "security-review.md has model: sonnet in frontmatter",
        "performance-check.md has model: haiku in frontmatter",
        "security-review.md covers secrets, input validation, API security, data protection",
        "performance-check.md covers rebuilds, providers, images, lists",
        "Skills only generated when preset includes skills (standard/full)",
        "npm run typecheck passes",
        ">= 5 tests (new skill content, count, preset gating, model hints)"
      ],
      "passes": true
    },
    {
      "id": "P8-011",
      "phase": 8,
      "priority": 59,
      "title": "Create add-feature command",
      "description": "Add an /add-feature slash command to generated projects. Generated .claude/commands/add-feature.md is a step-by-step guided workflow (10 steps) for adding a new feature following Clean Architecture: create directory structure, domain entities (freezed), repository interface, use cases, data model, data source, repository implementation, Riverpod providers, page (ConsumerWidget), route registration. Uses model: sonnet hint.",
      "acceptanceCriteria": [
        "writeCommands() generates add-feature.md alongside existing commands",
        "Command includes 10 concrete steps",
        "Steps reference Clean Architecture layers in correct order",
        "Conditional auth guard section if auth module enabled",
        "npm run typecheck passes",
        ">= 2 tests"
      ],
      "passes": true
    },
    {
      "id": "P8-012",
      "phase": 8,
      "priority": 60,
      "title": "Define new PRD schema",
      "description": "Create src/claude-setup/prd-schema.ts with a Zod schema for the new PRD format (version 2.0.0). Include: story fields (id, phase, priority enum P0-P3, title, description, module, storyPoints 1-13, dependencies array, acceptanceCriteria with description + optional machine-verifiable predicate, passes boolean). Top-level: version, project, generatedAt timestamp, phases array, stories array.",
      "acceptanceCriteria": [
        "PrdSchema validates the new PRD format with Zod",
        "Schema includes id, phase, priority, title, description, module, storyPoints",
        "acceptanceCriteria is array of objects with description + optional predicate",
        "dependencies is array of story IDs",
        "Schema exports TypeScript types",
        "npm run typecheck passes",
        ">= 6 tests (schema validation, invalid data rejection, type inference)"
      ],
      "passes": true
    },
    {
      "id": "P8-013",
      "phase": 8,
      "priority": 61,
      "title": "Overhaul PRD generator",
      "description": "Rewrite prd-generator.ts to produce the new PRD v2 format with machine-readable acceptance criteria, story dependencies, and story points. Story IDs use module prefix (P1-CORE-001, P2-AUTH-001). Each story has storyPoints (Fibonacci 1-13). Acceptance criteria have description + optional predicate. Stories declare explicit dependencies. Phase metadata at top level. generatedAt timestamp.",
      "acceptanceCriteria": [
        "generatePrd() returns JSON conforming to PrdSchema",
        "Story IDs use module prefix pattern",
        "Each story has storyPoints (Fibonacci: 1, 2, 3, 5, 8, 13)",
        "Acceptance criteria include both description and predicate",
        "Phase 2 stories correctly depend on Phase 1 completion",
        "Module-conditional stories only appear for enabled modules",
        "npm run typecheck passes",
        ">= 8 tests (all module combinations, dependencies, schema validation)"
      ],
      "passes": true
    },
    {
      "id": "P8-014",
      "phase": 8,
      "priority": 62,
      "title": "Update setup-orchestrator for new flow",
      "description": "Rewrite setup-orchestrator.ts to use preset resolution and call the new rules-writer. New flow: 1) resolve preset, 2) always generate slim CLAUDE.md, 3) if rules: generate .claude/rules/, 4) if agents: generate 3 agents, 5) if hooks: generate hook scripts + settings.local.json, 6) if skills: generate 6-7 skills, 7) if commands: generate slash commands, 8) if mcp: generate .mcp.json, 9) if !skipPrd: generate prd.json v2.",
      "acceptanceCriteria": [
        "Orchestrator uses resolvePreset() to determine what to generate",
        "Rules are generated as a new step",
        "All generated file paths included in filesWritten return",
        "Minimal preset generates only CLAUDE.md + rules",
        "Standard preset generates everything except MCP",
        "Full preset generates everything including MCP",
        "npm run typecheck passes",
        ">= 6 tests (each preset, file list assertions)"
      ],
      "passes": true
    },
    {
      "id": "P8-015",
      "phase": 8,
      "priority": 63,
      "title": "Update add and upgrade commands",
      "description": "Update the add and upgrade commands to work with the new claude setup. upgrade command backs up .claude/rules/ alongside agents. add command regenerates rules when modules change. Both commands use preset resolution.",
      "acceptanceCriteria": [
        "add command regenerates CLAUDE.md and rules when module added",
        "upgrade command backs up existing rules as .bak files",
        "Both commands respect claude.preset from config",
        "npm run typecheck passes",
        ">= 4 tests (add with new setup, upgrade with rules backup)"
      ],
      "passes": true
    },
    {
      "id": "P8-016",
      "phase": 8,
      "priority": 64,
      "title": "Integration tests for new generated output",
      "description": "Write comprehensive integration tests validating the complete generated output. 10 scenarios: minimal preset, standard preset, full preset, full module set, no modules, CLAUDE.md line count <= 100, agent count == 3, hook script permissions, PRD format v2 conformance, rule file YAML frontmatter.",
      "acceptanceCriteria": [
        ">= 10 integration test cases",
        "Tests use useTempDir() helper",
        "Tests validate actual file content (not just existence)",
        "CLAUDE.md line count enforced in tests",
        "Agent count enforced in tests",
        "All tests pass with npm test"
      ],
      "passes": true
    },
    {
      "id": "P8-017",
      "phase": 8,
      "priority": 65,
      "title": "Snapshot tests for generated files",
      "description": "Add Jest snapshot tests for all generated files to catch unintended changes. Snapshots for: generated CLAUDE.md (standard preset, auth+api modules), architecture.md rule, security.md rule, flutter-builder.md agent, prd.json (standard preset, auth module).",
      "acceptanceCriteria": [
        ">= 5 snapshot tests",
        "Snapshots capture representative generated content",
        "npm test -- -u can update snapshots",
        "All snapshots pass"
      ],
      "passes": true
    },
    {
      "id": "P8-018",
      "phase": 8,
      "priority": 66,
      "title": "Update existing tests for backward compatibility",
      "description": "Update existing tests that reference old agent names, old CLAUDE.md format, or old config schema fields. Files to update: claude-md-generator.test.ts, agent-writer.test.ts, hooks-writer.test.ts, skill-writer.test.ts, prd-generator.test.ts, config-schema.test.ts, create-command.test.ts. Ensure no it.skip() or it.todo() left behind.",
      "acceptanceCriteria": [
        "All existing tests updated to reflect new output",
        "No it.skip() or it.todo() left behind",
        "npm test passes all tests",
        "Coverage thresholds maintained"
      ],
      "passes": true
    },
    {
      "id": "P9-001",
      "phase": 9,
      "priority": 67,
      "title": "Implement plan CLI command",
      "description": "Create a new maxsim-flutter plan command that collects basic info (project name validated as snake_case, 1-2 sentence app description) and generates a planning workspace: project directory, .claude/skills/plan-app.md, docs/project-brief-template.md, partial maxsim.config.yaml with name + description. Print clear next-steps instructions (cd, claude, /plan-app).",
      "acceptanceCriteria": [
        "maxsim-flutter plan command is registered and works",
        "Prompts for project name (validated: snake_case)",
        "Prompts for app description (free text, 1-2 sentences)",
        "Creates project directory",
        "Generates .claude/skills/plan-app.md",
        "Generates docs/project-brief-template.md",
        "Generates partial maxsim.config.yaml with name + description",
        "Prints clear next-steps instructions",
        "npm run typecheck passes",
        ">= 4 tests"
      ],
      "passes": true
    },
    {
      "id": "P9-002",
      "phase": 9,
      "priority": 68,
      "title": "Generate project-brief template",
      "description": "Create src/plan/brief-template-generator.ts that generates docs/project-brief-template.md. Template includes sections: Problem Statement, Target Users (with persona template), Core User Journeys (numbered 1-5), Explicit Non-Goals, Success Metrics, App Description. Project name and description pre-filled from CLI input.",
      "acceptanceCriteria": [
        "Template includes all sections (problem, users, journeys, non-goals, metrics)",
        "Project name and description pre-filled from CLI input",
        "Markdown renders correctly",
        "npm run typecheck passes",
        ">= 2 tests"
      ],
      "passes": true
    },
    {
      "id": "P9-003",
      "phase": 9,
      "priority": 69,
      "title": "Generate plan-app skill â€” Vision & Features phase",
      "description": "Create src/plan/skill-generator.ts that generates the /plan-app Claude Code skill (model: opus). This story covers Steps 1-3: Step 1 (Understand Vision â€” 2 questions about problem and user journey), Step 2 (Define Core Features â€” 2-3 questions about top features, non-goals, team/solo), Step 3 (Technical Decisions â€” decision tree for auth provider, backend/database, platforms). Questions asked one at a time.",
      "acceptanceCriteria": [
        "Skill uses model: opus for complex reasoning",
        "Project name and description injected into skill body",
        "Steps 1-3 generate 6-8 focused questions in funnel order",
        "Decision tree for auth, backend, database, platforms",
        "Questions are asked one at a time (not all at once)",
        "npm run typecheck passes",
        ">= 4 tests (skill content, variable injection, question count)"
      ],
      "passes": true
    },
    {
      "id": "P9-004",
      "phase": 9,
      "priority": 70,
      "title": "Generate plan-app skill â€” Module suggestions phase",
      "description": "Extend src/plan/skill-generator.ts with Steps 4-5: Step 4 (Proactive module suggestions based on app type with decision matrix covering team-collaboration, e-commerce, content-social, utility-tool. Each suggestion has REQUIRED/RECOMMENDED/NICE-TO-HAVE priority with rationale). Step 5 (Confirm selections â€” summarize all decisions, ask for approval).",
      "acceptanceCriteria": [
        "Module suggestions are context-aware (based on app type)",
        "Each suggestion includes a rationale (WHY this module)",
        "Modules categorized as REQUIRED / RECOMMENDED / NICE-TO-HAVE",
        "Decision matrix covers 4+ app types",
        "Confirmation step summarizes all choices",
        "npm run typecheck passes",
        ">= 4 tests (suggestion matrix, rationale presence, app type coverage)"
      ],
      "passes": true
    },
    {
      "id": "P9-005",
      "phase": 9,
      "priority": 71,
      "title": "Generate plan-app skill â€” Artifact generation phase",
      "description": "Extend src/plan/skill-generator.ts with Steps 6-9: Step 6 (Generate project-brief.md from conversation), Step 7 (Generate architecture.md with provider tree ASCII diagram, navigation flow, database schema), Step 8 (Generate maxsim.config.yaml with all decisions), Step 9 (Generate prd.json v2 with stories from user journeys across 4 phases). Clear next-steps at the end.",
      "acceptanceCriteria": [
        "Skill generates project-brief.md from conversation data",
        "Skill generates architecture.md with provider tree and navigation flow",
        "Skill generates complete maxsim.config.yaml",
        "Skill generates prd.json using v2 format (from Phase 8)",
        "Architecture includes ASCII diagrams for provider tree and navigation",
        "PRD stories are derived from user journeys (not just module-based)",
        "Clear next-steps instructions at the end",
        "npm run typecheck passes",
        ">= 6 tests (each artifact generation, content validation)"
      ],
      "passes": true
    },
    {
      "id": "P9-006",
      "phase": 9,
      "priority": 72,
      "title": "Create app-type classifier for module suggestions",
      "description": "Create src/plan/app-type-classifier.ts with keyword-based classifier mapping app descriptions to AppType (team-collaboration, e-commerce, content-social, utility-tool, fitness-health, education, general). Returns AppTypeResult with type, confidence (0-1), and suggestedModules array (moduleId, priority, rationale). Default 'general' suggests auth + api + theme.",
      "acceptanceCriteria": [
        "Classifier returns AppType + confidence + suggested modules",
        "Covers 6+ app types",
        "Each app type maps to specific module suggestions with rationale",
        "Default general type has sensible suggestions",
        "npm run typecheck passes",
        ">= 6 tests (each app type, keyword matching, default case)"
      ],
      "passes": true
    },
    {
      "id": "P9-007",
      "phase": 9,
      "priority": 73,
      "title": "Create architecture document generator",
      "description": "Create src/plan/architecture-generator.ts that generates architecture.md with: tech stack section with rationale, module architecture overview, ASCII provider tree diagram (based on selected modules), ASCII navigation flow diagram (based on user journeys), database schema outline (if database module selected).",
      "acceptanceCriteria": [
        "Generates provider tree as ASCII art based on enabled modules",
        "Generates navigation flow as ASCII art",
        "Tech stack section adapts to module selections",
        "Database schema section only appears when database module enabled",
        "npm run typecheck passes",
        ">= 4 tests (full modules, minimal, provider tree, nav flow)"
      ],
      "passes": true
    },
    {
      "id": "P9-008",
      "phase": 9,
      "priority": 74,
      "title": "Create journey-to-stories converter",
      "description": "Create src/plan/journey-to-stories.ts â€” a template/prompt embedded in the plan-app skill that instructs Claude to decompose each user journey into PRD stories. Each journey produces 2-4 stories following domain â†’ data â†’ presentation â†’ tests layers. Stories have >= 3 acceptance criteria with predicates, correct dependency chains, Fibonacci story points.",
      "acceptanceCriteria": [
        "Journey decomposition template produces domain/data/presentation stories",
        "Each generated story has >= 3 acceptance criteria with predicates",
        "Stories have correct dependencies (domain first, then data, then presentation)",
        "Story points follow Fibonacci (1, 2, 3, 5, 8)",
        "Test stories generated for each feature",
        "npm run typecheck passes",
        ">= 6 tests (decomposition pattern, dependency chain, criteria format)"
      ],
      "passes": true
    },
    {
      "id": "P9-009",
      "phase": 9,
      "priority": 75,
      "title": "Wire plan command into CLI",
      "description": "Register the plan command in src/cli/index.ts and create src/plan/index.ts as barrel export. Ensure the command works end-to-end with all generators (brief template, skill generator, config writer). maxsim-flutter plan appears in help output.",
      "acceptanceCriteria": [
        "maxsim-flutter plan appears in help output",
        "Command creates project directory",
        "All 3 generated files exist after running",
        "npm run typecheck passes",
        ">= 3 tests"
      ],
      "passes": true
    },
    {
      "id": "P9-010",
      "phase": 9,
      "priority": 76,
      "title": "Integration tests for plan command",
      "description": "Write tests/integration/plan-command.test.ts with 10 scenarios: plan command creates correct directory structure, plan-app.md has model: opus, skill includes all 9 steps, skill has module suggestion matrix, project-brief template has all sections, app-type classifier returns correct types, architecture generator produces valid ASCII diagrams, journey-to-stories produces valid story structure, partial maxsim.config.yaml is valid YAML, generated artifacts work with create --config.",
      "acceptanceCriteria": [
        ">= 10 integration test cases",
        "Tests validate generated skill content",
        "Tests validate architecture ASCII diagrams",
        "Tests validate journey decomposition",
        "All tests pass with npm test"
      ],
      "passes": true
    },
    {
      "id": "P9-011",
      "phase": 9,
      "priority": 77,
      "title": "Update documentation and README",
      "description": "Document the new plan command in README.md (add plan command section with example workflow showing the 3-artifact output) and CONTRIBUTING.md (describe src/plan/ module structure).",
      "acceptanceCriteria": [
        "README includes maxsim-flutter plan with example workflow",
        "README shows the 3-artifact output",
        "CONTRIBUTING.md describes src/plan/ module structure",
        "npm run typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "P10-001",
      "phase": 10,
      "priority": 78,
      "title": "Remove dead ralph stub files",
      "description": "src/ralph/prd-generator.ts, src/ralph/ralph-converter.ts, and src/ralph/story-sizer.ts are empty stubs with only a TODO comment referencing P3-006. They are never imported anywhere. The working PRD generator lives in src/claude-setup/prd-generator.ts. Remove all three stub files and the src/ralph/ directory entirely. If any imports or barrel exports reference them, remove those too.",
      "acceptanceCriteria": [
        "src/ralph/ directory no longer exists",
        "No imports referencing src/ralph/ remain in the codebase",
        "npm run typecheck passes",
        "npm run lint passes",
        "npm test passes"
      ],
      "passes": true
    },
    {
      "id": "P10-002",
      "phase": 10,
      "priority": 79,
      "title": "Add missing rules for theme, push, analytics, cicd, and deep-linking modules",
      "description": "claude-md-generator.ts generates @.claude/rules/ imports for theme.md, push.md, analytics.md, cicd.md, and deep-linking.md when those modules are enabled, but rules-writer.ts never creates those files. This produces broken references in the generated CLAUDE.md. Add rule generation functions for all 5 missing modules in rules-writer.ts and wire them into writeRules() with the appropriate module guards.",
      "acceptanceCriteria": [
        "rules-writer.ts generates theme.md when context.modules.theme is enabled",
        "rules-writer.ts generates push.md when context.modules.push is enabled",
        "rules-writer.ts generates analytics.md when context.modules.analytics is enabled",
        "rules-writer.ts generates cicd.md when context.modules.cicd is enabled",
        "rules-writer.ts generates deep-linking.md when context.modules.deepLinking is enabled",
        "Each rule file has correct YAML frontmatter with relevant path globs",
        "Each rule file contains concise, actionable guidelines specific to the module",
        "No broken @.claude/rules/ references in generated CLAUDE.md for any module combination",
        "npm run typecheck passes",
        "npm test passes",
        ">= 5 new tests (one per missing rule file)"
      ],
      "passes": true
    },
    {
      "id": "P10-003",
      "phase": 10,
      "priority": 80,
      "title": "Remove or wire unused plan helper modules",
      "description": "src/plan/app-type-classifier.ts, src/plan/architecture-generator.ts, and src/plan/journey-to-stories.ts are implemented and have tests, but are never imported by any production code. The plan command delegates all artifact generation to the interactive Claude skill (plan-app.md), so these modules serve no runtime purpose. Per YAGNI, either remove them entirely (including their tests) or wire them into the plan orchestrator if they provide value. Decision: remove them since the skill handles this interactively.",
      "acceptanceCriteria": [
        "src/plan/app-type-classifier.ts is removed",
        "src/plan/architecture-generator.ts is removed",
        "src/plan/journey-to-stories.ts is removed",
        "Corresponding test files are removed",
        "No dangling imports remain in the codebase",
        "src/plan/index.ts barrel export (if any) is updated",
        "npm run typecheck passes",
        "npm run lint passes",
        "npm test passes"
      ],
      "passes": true
    },
    {
      "id": "P10-004",
      "phase": 10,
      "priority": 81,
      "title": "Add --no-claude flag to add command",
      "description": "The create command supports --no-claude to skip Claude setup generation, but the add command always regenerates .claude/ setup when adding a module. Add the same --no-claude flag to the add command so users can opt out of Claude setup regeneration when adding modules.",
      "acceptanceCriteria": [
        "maxsim-flutter add --no-claude skips Claude setup regeneration",
        "maxsim-flutter add --help shows the --no-claude option",
        "Default behavior (without flag) still regenerates Claude setup as before",
        "npm run typecheck passes",
        ">= 2 tests (with and without --no-claude flag)"
      ],
      "passes": true
    },
    {
      "id": "P10-005",
      "phase": 10,
      "priority": 82,
      "title": "Fix P9-010 failing integration tests for plan command",
      "description": "P9-010 (Integration tests for plan command) is the only story still marked as passes: false. Investigate why the tests fail, fix the root cause, and ensure all 10+ integration test scenarios pass. Then mark P9-010 as passes: true.",
      "acceptanceCriteria": [
        "tests/integration/plan-command.test.ts exists with >= 10 test cases",
        "All plan command integration tests pass",
        "npm test passes all tests",
        "P9-010 can be marked as passes: true"
      ],
      "passes": true
    },
    {
      "id": "P10-006",
      "phase": 10,
      "priority": 83,
      "title": "Audit and fix all quality gates",
      "description": "Run the full quality suite (npm run quality:full) and fix any issues found. This includes: typecheck must pass with zero errors, lint must pass with zero errors, all tests must pass, coverage must meet thresholds defined in jest.config.mjs. Also verify there are no it.skip() or it.todo() left in any test files.",
      "acceptanceCriteria": [
        "npm run typecheck passes with zero errors",
        "npm run lint passes with zero errors",
        "npm test passes all tests",
        "Coverage meets all thresholds from jest.config.mjs",
        "No it.skip() or it.todo() in any test file",
        "npm run quality:full passes completely"
      ],
      "passes": true
    },
    {
      "id": "P11-001",
      "phase": 11,
      "priority": 84,
      "title": "Upgrade generated agent definitions with best-practice patterns",
      "description": "Overhaul agent-writer.ts to generate agents that follow agentic coding best practices (see docs/agentic-claude-code-reference.md). Currently generates 3 agents (flutter-builder, flutter-tester, flutter-reviewer). Improvements: (1) Add AgentDefinition.isolation field support â€” set 'worktree' for builder and tester to prevent file conflicts in team mode. (2) Add AgentDefinition.memory field â€” set true for reviewer so it learns project patterns across sessions. (3) Add explicit 'Scope Boundaries' section to each agent body with 'Do NOT...' rules. (4) Fix model selection: builder should use 'opus' (not sonnet) per best practices â€” non-trivial implementation work benefits from Opus. (5) Add a new 'flutter-architect' agent (read-only: Read, Grep, Glob, WebSearch) for planning architecture before implementation. (6) Update AgentDefinition interface to include optional isolation, memory, maxTurns fields. (7) Update formatAgentMarkdown() to emit new frontmatter fields. Reference docs/agentic-claude-code-reference.md Section 1 for complete frontmatter spec.",
      "acceptanceCriteria": [
        "Tests written first (TDD)",
        "AgentDefinition interface includes isolation?, memory?, maxTurns? fields",
        "formatAgentMarkdown() emits isolation, memory, maxTurns when present",
        "flutter-builder agent uses model opus and isolation worktree",
        "flutter-tester agent uses isolation worktree",
        "flutter-reviewer agent has memory: true",
        "New flutter-architect agent generated with read-only tools",
        "All 4 agents have 'Scope Boundaries' section with Do NOT rules",
        "npm run quality passes"
      ],
      "passes": true
    },
    {
      "id": "P11-002",
      "phase": 11,
      "priority": 85,
      "title": "Add protect-secrets hook and notification hook to generated setup",
      "description": "Extend hooks-writer.ts to generate additional hooks following best practices (see docs/agentic-claude-code-reference.md Section 3). Currently generates block-dangerous.sh and format-dart.sh. Add: (1) protect-secrets.sh â€” PreToolUse hook on Read|Edit|Write that blocks access to .env, .env.*, credentials*, secrets*, *.pem, *.key files. Uses JSON decision output format: {decision:block, reason:...}. (2) notify-waiting.sh â€” Notification hook that sends desktop notifications (cross-platform: osascript on macOS, notify-send on Linux, PowerShell toast on Windows). (3) Update HooksConfig to register both new hooks. (4) Add timeout field to hook entries (5 seconds for secrets, 10 for notification). Reference docs/agentic-claude-code-reference.md Section 3 for hook event types and JSON schemas.",
      "acceptanceCriteria": [
        "Tests written first (TDD)",
        "protect-secrets.sh generated in .claude/hooks/ with correct file-blocking logic",
        "notify-waiting.sh generated with cross-platform notification support",
        "HooksConfig registers protect-secrets as PreToolUse on Read|Edit|Write",
        "HooksConfig registers notify-waiting as Notification hook",
        "Hook entries include timeout field",
        "All generated scripts are chmod 755",
        "npm run quality passes"
      ],
      "passes": true
    },
    {
      "id": "P11-003",
      "phase": 11,
      "priority": 86,
      "title": "Generate settings.json with deny permissions and proper hook registration",
      "description": "Currently hooks-writer.ts only generates settings.local.json with hooks config. Add generation of .claude/settings.json (team-shared config) containing: (1) hooks section â€” move hook registration from settings.local.json to settings.json since hooks should be shared. (2) Add deny permissions array blocking .env, .env.*, credentials*, secrets*, *.pem, *.key. (3) Keep settings.local.json for local-only allow permissions (flutter commands, git operations). This follows the best practice of separating shared config (settings.json committed to git) from local config (settings.local.json gitignored). Reference docs/agentic-claude-code-reference.md Section 6 for permission system and evaluation order (Deny > Ask > Allow).",
      "acceptanceCriteria": [
        "Tests written first (TDD)",
        ".claude/settings.json generated with hooks and deny permissions",
        "settings.json contains deny rules for .env, credentials, secrets, pem, key files",
        "settings.local.json contains only allow permissions for flutter/git commands",
        "Hook registration moved from settings.local to settings.json",
        "setup-orchestrator.ts calls the settings generation",
        "npm run quality passes"
      ],
      "passes": false
    },
    {
      "id": "P11-004",
      "phase": 11,
      "priority": 87,
      "title": "Generate .claude/rules/ with path-scoped rule files",
      "description": "Enhance rules-writer.ts to add YAML frontmatter with 'paths' field to all generated rule files, following the .claude/rules/ best practice (see docs/agentic-claude-code-reference.md Section 4 and 7). Currently generates rule files without paths frontmatter. Add: (1) 'paths' frontmatter to every rule file so rules only load when editing matching files. Examples: architecture.md paths: ['lib/**'], testing.md paths: ['test/**'], riverpod.md paths: ['lib/**/providers/**', 'lib/**/presentation/**']. (2) Add a new 'git-workflow.md' rule with commit conventions, branch naming for Flutter projects. (3) Add 'code-quality.md' rule with flutter analyze, dart format, test coverage expectations. This makes rules context-aware: Claude only sees architecture rules when editing lib/, testing rules when editing test/, etc.",
      "acceptanceCriteria": [
        "Tests written first (TDD)",
        "All existing rule files include paths frontmatter with relevant glob patterns",
        "architecture.md scoped to lib/**",
        "testing.md scoped to test/**",
        "riverpod.md scoped to lib/**/providers/**, lib/**/presentation/**",
        "go-router.md scoped to lib/**/router/**, lib/**/routes/**",
        "New git-workflow.md rule generated with commit conventions",
        "New code-quality.md rule generated with flutter analyze expectations",
        "npm run quality passes"
      ],
      "passes": false
    },
    {
      "id": "P11-005",
      "phase": 11,
      "priority": 88,
      "title": "Make quality-related skills proactively activatable",
      "description": "Update skill-writer.ts so that quality-focused skills can be auto-triggered by Claude (see docs/agentic-claude-code-reference.md Section 2). Currently all skills use string bodies without frontmatter control. Changes: (1) Add disable-model-invocation: false to security-review and performance-check skills so Claude can auto-trigger them before commits. (2) Improve descriptions with clear trigger phrases: 'Use proactively before git commits, after completing feature work, or when user asks about code quality/security/performance.' (3) Add a new 'quality-gate' skill that runs flutter analyze + flutter test + coverage check as a combined pre-commit validation. (4) Update SkillDefinition interface to support frontmatter fields: disable-model-invocation, user-invocable, allowed-tools, context. Reference docs/agentic-claude-code-reference.md Section 2 for the decision matrix and activation patterns.",
      "acceptanceCriteria": [
        "Tests written first (TDD)",
        "SkillDefinition interface includes disableModelInvocation?, userInvocable?, allowedTools?, context? fields",
        "security-review skill has proactive trigger description",
        "performance-check skill has proactive trigger description",
        "New quality-gate skill generated with combined flutter analyze + test",
        "Skill frontmatter correctly emitted in generated SKILL.md files",
        "npm run quality passes"
      ],
      "passes": false
    },
    {
      "id": "P11-006",
      "phase": 11,
      "priority": 89,
      "title": "Add start-team command for generated Flutter projects",
      "description": "Add a new 'start-team' slash command to commands-writer.ts that orchestrates Claude Code Agent Teams for Flutter projects (see docs/agentic-claude-code-reference.md Section 5). The generated /start-team command should: (1) Read prd.json to find incomplete stories in current phase. (2) Pre-flight: git clean, flutter analyze passes, flutter test passes. (3) Create team 'flutter-sprint' with TaskCreate for each story. (4) Spawn 4 agents: architect (opus), builder (opus), tester (sonnet), reviewer (haiku). (5) Orchestrate TDD flow: Architect â†’ Builder (RED+GREEN) â†’ Tester (edge cases) â†’ Reviewer â†’ Quality gates. (6) Commit + push after each story passes. (7) Use correct model assignments per best practices. This is the most complex command and should reference the agent team patterns from the docs.",
      "acceptanceCriteria": [
        "Tests written first (TDD)",
        "start-team.md command generated in .claude/commands/",
        "Command reads prd.json for sprint planning",
        "Pre-flight checks: git status, flutter analyze, flutter test",
        "Spawns 4 agents with correct models (architect=opus, builder=opus, tester=sonnet, reviewer=haiku)",
        "TDD flow orchestration documented (Architect â†’ Builder â†’ Tester â†’ Reviewer)",
        "Commit + push protocol after each story",
        "npm run quality passes"
      ],
      "passes": false
    },
    {
      "id": "P11-007",
      "phase": 11,
      "priority": 90,
      "title": "Shorten generated CLAUDE.md and use @-imports for rules",
      "description": "Optimize claude-md-generator.ts to produce a shorter, more focused CLAUDE.md following the under-150-lines best practice (see docs/agentic-claude-code-reference.md Section 4). Currently generates ~80-100 lines which is good, but: (1) Replace inline rule descriptions with @.claude/rules/filename.md imports where already present. (2) Remove information Claude can infer from reading code (standard Flutter conventions, obvious file naming). (3) Add emphasis markers (IMPORTANT, NEVER, MUST) for critical rules only. (4) Add model usage policy section: Opus for non-trivial work, Sonnet for simple tasks, Haiku for scans. (5) Add link to docs/agentic-claude-code-reference.md as detailed reference for agents. (6) Ensure generated CLAUDE.md stays under 120 lines total.",
      "acceptanceCriteria": [
        "Tests written first (TDD)",
        "Generated CLAUDE.md is under 120 lines",
        "Uses @.claude/rules/ imports instead of inline rule descriptions",
        "Model usage policy section present (Opus/Sonnet/Haiku guidance)",
        "Critical rules use IMPORTANT/NEVER/MUST emphasis",
        "No redundant information Claude can infer from code",
        "npm run quality passes"
      ],
      "passes": false
    },
    {
      "id": "P11-008",
      "phase": 11,
      "priority": 91,
      "title": "Add TaskCompleted quality-gate hook with proper JSON decision format",
      "description": "Upgrade the TaskCompleted hook in hooks-writer.ts from a simple inline command to a proper shell script with JSON decision output (see docs/agentic-claude-code-reference.md Section 3). Currently: TaskCompleted runs 'flutter analyze && flutter test' as inline command. Problems: no structured output, no timeout, no conditional logic. Fix: (1) Create quality-gate-task.sh that reads JSON stdin, checks if task is an implementation task (not review/status), runs flutter analyze + flutter test, outputs structured feedback. (2) Add timeout: 60 to the hook (flutter test can be slow). (3) Output reminder message listing quality checks when implementation tasks complete. (4) Ensure the hook doesn't block on non-implementation tasks (reviews, status checks).",
      "acceptanceCriteria": [
        "Tests written first (TDD)",
        "quality-gate-task.sh generated as proper shell script",
        "Script reads JSON stdin and extracts task subject",
        "Only triggers for implementation tasks (pattern: P\\d+-)",
        "Outputs quality reminder with specific checks",
        "Hook registered with timeout: 60",
        "Inline 'flutter analyze && flutter test' replaced with script reference",
        "npm run quality passes"
      ],
      "passes": false
    },
    {
      "id": "P11-009",
      "phase": 11,
      "priority": 92,
      "title": "Integration tests for all Phase 11 generated output",
      "description": "Write comprehensive integration tests verifying all Phase 11 changes produce correct output. Tests should: (1) Verify 4 agents generated (not 3) with correct frontmatter (isolation, memory, model). (2) Verify protect-secrets.sh and notify-waiting.sh exist and are executable. (3) Verify settings.json has deny permissions and hook registration. (4) Verify all rule files have paths frontmatter. (5) Verify quality-related skills have proactive descriptions. (6) Verify start-team.md command exists with correct team composition. (7) Verify CLAUDE.md is under 120 lines with @-imports. (8) Verify quality-gate-task.sh exists as proper script. (9) Test with all 3 presets (minimal, standard, full) to ensure feature flags work.",
      "acceptanceCriteria": [
        "Tests written first (TDD)",
        "Integration test covers all 3 presets (minimal/standard/full)",
        "Agent count verified: 4 agents for standard/full preset",
        "Hook scripts verified: 4 scripts (block-dangerous, format-dart, protect-secrets, notify-waiting)",
        "settings.json verified with deny permissions",
        "Rule files verified with paths frontmatter",
        "Skill proactive activation verified",
        "start-team command verified",
        "CLAUDE.md line count verified under 120",
        "All existing tests still pass",
        "npm run quality passes"
      ],
      "passes": false
    }
  ]
}
